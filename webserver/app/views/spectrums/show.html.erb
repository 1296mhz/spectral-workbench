<div class="sidebar spectrumpage">
<div id="compare" class="box">
  <h3>Compare to other spectra</h3>
  <p><small>Currently, comparisons are only valid between spectra from one spectrometer. Once we add wavelength calibration tools, you'll be able to compare to other peoples' data... <a href="http://github.com/jywarren/spectral-workbench/issues/36">coming soon!</a></small></p>
  <p>
    <form id="compareForm" action="javascript:void(0);">
    <input class='text' id='searchinput' type='text' name='q' value=''/>
    <input type='submit' id='searchsubmit' value='search' />
    </form>
    <script>

        $.ajaxSetup ({ cache: false }); 

	var ajax_load = "<img src='/images/spinner-small.gif' alt='loading...' />";

	$("#compareForm").submit(function(){
		var url = "/spectrums/compare/<%= @spectrum.id %>?q="+$("#searchinput").val();
		$("#result").html(ajax_load).load(url);
	});

    </script>
  </p>
  <div id="result">
    <b>Recent spectra:</b><br />
    <%= render :partial => "compare" %>
  </div>
</div>
</div>

<p>
<img src="<%= @spectrum.photo.url(:large) %>" />
<div id="graph" style="width:800px;height:200px;"></div>
<script type="text/javascript">
  <% if @spectrum.data == "" || @spectrum.data.nil? %>
    spectrum = <%= @spectrum.extract_data %>
  <% else %>
    spectrum = <%= @spectrum.data.chomp(",") %>
  <% end %>
    data = [{label: "<%= @spectrum.title %>",data:[]}]
    scaled = true
    $.each(spectrum.lines,function(index,line) {
      if (line.wavelength == null) {
	line.wavelength = index
	scaled = false
      }
      data[0].data.push([line.wavelength,line.average])
    })
    options = {
      series: {
        lines: { 
          show: true, 
          lineWidth: 1,
        },
      },
      yaxis: { show: false },
      xaxis: { show: scaled },
      shadowSize: 0,
      grid: {
        backgroundColor: "#eee"
      },
      // Palette "i eat the rainbow" by svartedauden on Colourlovers: http://www.colourlovers.com/palette/1630898/i_eat_the_rainbow, CC-BY-NC
      colors: [ "#333333", "#E02130", "#FAB243", "#429867", "#2B5166" ]//, "#482344" ]
    }
    $.plot($("#graph"),data,options);
</script>
</p>

<h1><%= @spectrum.title %></h1>

<h3>Notes</h3>
<p class="description"><%= markdown(@spectrum.notes) if @spectrum.notes %></p>

<h3>Share</h3>

<p>Embed code: <input id="embedcode" type="text" value="<iframe width='500px' height='400px' border='0' src='http://spectralworkbench.org/spectra/embed/<%= @spectrum.id %>'></iframe>" /></p>

<script>
$('#embedcode').click(function() {
	this.focus()
	this.select()
})
</script>

<h3>License</h3>

<p xmlns:dct="http://purl.org/dc/terms/" xmlns:vcard="http://www.w3.org/2001/vcard-rdf/3.0#">
  <a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/"><img src="http://i.creativecommons.org/p/zero/1.0/88x31.png" style="border-style: none;" alt="CC0" /></a>
  <br />
  To the extent possible under law,
  <%# if @spectrum.author.url %><a rel="dct:publisher" href="http://publiclaboratory.org"><%# end %>
    <span property="dct:title"><%= @spectrum.author %></span>
  <%# if @spectrum.author.url %></a><%# end %>
  has waived all copyright and related or neighboring rights to
  "<span property="dct:title"><%= @spectrum.title %></span>".
This work is published from:
<span property="vcard:Country" datatype="dct:ISO3166"
      content="US" about="http://publiclaboratory.org">
  United States</span>.
</p>

<hr />

<a name="comments"></a>
<h2>Comments</h2>

<% @spectrum.comments.each do |comment| %>
<div class="comment">
	<b><%= time_ago_in_words(comment.created_at) %> ago, <%= comment.author %> wrote:</b>
	<p><%= comment.body %></p>
</div>
<% end %>

<% form_for(@comment) do |f| %>

  <h2>Post a comment</h2>
  <%= f.error_messages %>

  <p>
    <%= f.label :body %><br />
    <%= f.text_area :body, :rows => 6 %>
  </p>

  <p>
    <%= f.label :author %><br />
    <%= f.text_field :author %>
  </p>
  <p>
    <%= f.label :email %><br />
    <%= f.text_field :email %>
  </p>
  <p>
    <%= recaptcha_tags :display => {:theme => "white"} %>
  </p>

  <input type='hidden' name='id' value='<%= @spectrum.id %>' />

  <p>
    <%= f.submit 'Create' %>
  </p>
<% end %>

<h2>Related spectra</h2>

<p>coming soon...</p>


