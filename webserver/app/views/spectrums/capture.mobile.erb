<script src="/javascripts/getUserMedia.js"> </script>
<script src="/javascripts/capture.js"> </script>

<div data-role="page" id="page1">
  <div data-theme="d" data-role="header">
    <h3>
    SpectralWorkbench
    </h3>
  </div>
  <div data-role="content" style="padding: 15px">

	<div id="graph" style="width:100%;height:100px;"></div>
	<br />
	<canvas style="width:100%;height:100px;" id="canvas"></canvas> 
	<div style="width:100%;display:none;" id="webcam"></div> 

    <a data-role="button" data-transition="fade" data-theme="b" href="#page2" onClick="$W.saveSpectrum();">Save</a>

    <div data-role="fieldcontain">
      <fieldset data-role="controlgroup">
        <label for="toggleswitch1">Geotag</label>
        <select name="toggleswitch1" id="geotag-toggle" data-theme="c" data-role="slider" data-mini="true">
           <option value="off">Off</option>
           <option value="on">On</option>
        </select>
      </fieldset>
    </div>

    <p>This interface works only on <a href="https://play.google.com/store/apps/details?id=com.opera.browser">Opera Mobile</a>, the only mobile browser currently supporting the MediaStream API</p>

  </div>
</div>

<div data-role="page" id="page2">

	<h2>Save this spectrum</h2>

	<% if !logged_in? %>
		<p>You must be <a target="_blank" href="/login">logged in</a> to save spectra.</p>
	<% else %>
		<p>(logged in as <%=h current_user.login %>)</p>
	<% end %>

	<form action="/spectrums" method="post" id="saveForm">
		<label for="spectrum_title">Title:</label><br />
		<input name="spectrum[title]" id="spectrum_notes" type="text" /><br />
		<label for="tags">Tags:</label><br />
		<input name="tags" id="spectrum_tags" value="mobile," type="text" /><br />
		<label for="spectrum_notes">Notes:</label>
		<textarea name="spectrum[notes]" id="spectrum_notes"></textarea><br />
		<input name="dataurl" type="hidden" id="dataurl" />
		<input name="geotag" type="hidden" id="geotag" />
		<input name="lat" type="hidden" id="lat" />
		<input name="lon" type="hidden" id="lon" />
		<select name="spectrum[calibration_id]" id="calibration_id">
			<% current_user.tag('calibration').each do |spectrum| %>
			<option value="<%= spectrum.id %>"><%= spectrum.title %> (<%= time_ago_in_words(spectrum.created_at) %>)</option>
			<% end %>
		</select>
	</form>
	<a data-role="button" data-transition="fade" data-theme="b" href="javascript:void(0);" onClick="$('#saveForm').submit()">Save</a>
	<a data-role="button" data-transition="fade" data-theme="d" href="#page1" onClick="$W.cancelSave()">Cancel</a>

</div>

<div data-role="page" id="page3">
	<div data-role="fieldcontain">
		<fieldset data-role="controlgroup" data-mini="true">
			<label for="sample_slider">Range</label>
			<input type="range" name="slider" id="sample_slider" value="250" min="0" max="640" data-highlight="false" />
		</fieldset>
	</div>
</div>

<script> (function () { 
	$W.initialize(<%= !@calibration.nil? %>) 
	setInterval($W.getRow,500)
	<% if @calibration %>
		$W.calibrated = true
		$W.calibration_id = <%= @calibration.id %>
		$W.start_wavelength = <%= @start_wavelength %>
		$W.end_wavelength = <%= @end_wavelength %>
    		flotoptions.xaxis.show = true
	<% else %>
		$W.calibrated = false
	<% end %>
})() </script>
