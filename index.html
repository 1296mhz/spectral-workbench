<html>
<head>
	<script src="lib/prototype-1.6.1.js" type="text/javascript"></script>
	<script src="lib/canvas.js" type="text/javascript"></script>
	<script src="lib/shortcut.js" type="text/javascript"></script>
	<script src="fred.js" type="text/javascript"></script>
	<link rel="stylesheet" href="fred.css" type="text/css" media="screen" title="no title" charset="utf-8">
	<link rel="stylesheet" href="spectro.css" type="text/css" media="screen" title="no title" charset="utf-8">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width; height=device-height; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
</head>
<body onload="Fred.init();setup(); //learn how to customize the Fred environment at http://github.com/jywarren/fred">

	<div id="fred"></div>

	<a href="javascript:void(0)" class='button' onClick='Fred.tools.upload.prompt()'>Upload image [+]</a>

	<script>

	function setup() {
		Fred.observe('fred:postdraw',draw)
		Fred.select_tool('select')
		Fred.text_style.fontColor = 'white'
		Fred.keys.add('up',function() {Fred.active_layer.objects.last().y -= 1})
		Fred.keys.add('down',function() {Fred.active_layer.objects.last().y += 1})
		Fred.keys.add('left',function() {Fred.active_layer.objects.last().x -= 1})
		Fred.keys.add('right',function() {Fred.active_layer.objects.last().x += 1.1})
		Fred.keys.add('3',function() {Fred.active_layer.objects.last().scale *= 1.1})
		Fred.keys.add('4',function() {Fred.active_layer.objects.last().scale *= 0.9})
		Fred.keys.add('1',function() {Fred.active_layer.objects.last().r -= 0.1})
		Fred.keys.add('2',function() {Fred.active_layer.objects.last().r += 0.1})
	}
	function draw() {
		save()
			fillStyle('white')
			opacity(0.3)
			rect(0,0,Fred.width,parseInt(Fred.height/2))
			rect(Fred.pointer_x,0,1,Fred.height)
			rect(0,parseInt(Fred.height/2),Fred.width,1)
		restore()
		save()
			Fred.text('Line up the spectrum with the horizontal line to see its graph.',Fred.width-560,30)
		restore()
		// Fenerate spectrum:
		// Read line of pixels:
		try {
		var slice = Fred.active_layer.canvas.getImageData(0,parseInt(Fred.height/2)+1,Fred.width,1)
		} catch(e) {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead")
			var slice = Fred.active_layer.canvas.getImageData(0,parseInt(Fred.height/2)+1,Fred.width,1)
		}

		// The CanvasPixelArray object can be accessed to look at the raw pixel data; 
		// each pixel is represented by four one-byte values (red, green, blue, and alpha,
		// in that order; that is, "RGBA" format). Each color component is represented by 
		// an integer between 0 and 255. Each component is assigned a consecutive index 
		// within the array, with the top left pixel's red component being at index 0 within 
		// the array. Pixels then proceed from left to right, then downward, throughout the array.

		//The CanvasPixelArray contains height x width x 4 bytes of data, with index values 
		// ranging from 0 to (height x width x 4)-1.

		// to read the blue component's value from the pixel at 
		// column 200, row 50 in the image, you would do the following:
		// blue = imageData.data[((50*(imageData.width*4)) + (200*4)) + 2];
		var row = 0
		var column = Fred.pointer_x
		var columns = []
		save()
		beginPath()	
		moveTo(0,parseInt(Fred.height/2)+1)
		for (i=0;i<Fred.width;i++) {
			var red = slice.data[((row*(slice.width*4)) + (i*4)) + 0];
			var green = slice.data[((row*(slice.width*4)) + (i*4)) + 1];
			var blue = slice.data[((row*(slice.width*4)) + (i*4)) + 2];
			var amplitude = (red+blue+green)/3
			columns.push([red,green,blue,amplitude])
			lineTo(i,parseInt(Fred.height/2)+1-amplitude)
		}
		strokeStyle('white')
		lineWidth(1)
		stroke()
		//console.log(amplitude+' '+red+','+green+','+blue+': '+(parseInt(Fred.pointer_x)))	
		restore()
	}

	</script>

</body>
</html>
